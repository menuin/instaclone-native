# ğŸ‰ DEVLOG 8/2



### #16.2  Header Domination

- headerë¥¼ ì‚¬ìš©ìì— ë”°ë¼ dynamic í•˜ê²Œ ë°”ê¾¸ê¸° (componentë¥¼ í—¤ë”ì— ë„£ê¸°)

- route objectì— ì»´í¬ë„ŒíŠ¸ë¡œ ë³´ë‚´ì§„ parameterë“¤ì´ ë‹´ê¹€

  ```js
  export default function Profile({navigation, route}) {
  ```

- navigation objectì˜ setOptions ì‚¬ìš©

```js
useEffect(() => {
    if (route?.params?.username) {
        navigation.setOptions({
        title: route.params.username,
        })
}
}, [])
```



- Me screen í—¤ë”ì— ë‚´ username ëœ¨ê²Œ í•˜ê¸°

  - useMe hookì¶”ê°€ (í”„ë¡ íŠ¸ì—ì„œ ê°€ì ¸ì˜´)
  - ìœ„ë‘ ë˜‘ê°™ì´ í•¨

  ```js
  // Me.js
      const { data } = useMe();
      useEffect(() => {
          navigation.setOptions({
              title: data?.me?.username,
          })
      }, [])
  ```



### #16.3 Search part 1

- í—¤ë”ì— ì»´í¬ë„ŒíŠ¸ë¥¼ ë„£ì„ ìˆ˜ ìˆìŒ

```js
// Search.js
const SearchBox = () => {
        return (
            <TextInput
                style={{ backgroundColor: "white" }}
                placeholderTextColor="black"
                placeholder="Search photos"
                autoCapitalize="none"
                returnKeyType="search" />
        )
    }
    useEffect(() => {
        navigation.setOptions({
            headerTitle: SearchBox,
        })
    }, [])
```

- dismissKeyboard (loginì—ì„œ í–ˆì—ˆìŒ #14.8) ì»´í¬ë„ŒíŠ¸ë¡œ ë¹¼ê¸°

 

- state ë§Œë“¤ê¸°

```js
const { setValue, register, watch } = useForm();

    const SearchBox = () => {
        return (
            <TextInput
	
                onChangeText={(text) => setValue("keyword", text)} />
        )
    }
    
useEffect(() => {
    navigation.setOptions({
        headerTitle: SearchBox,
    })
    register("keyword")
}, []);
```



### #16.4 Search part 2

- tab bar ì— user profile iconì„ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì‚¬ì§„ìœ¼ë¡œ ë°”ê¾¸ê¸°
  - useMe : user id, username, avatarë¥¼ ì¤Œ, í•œë²ˆë§Œ ì‹¤í–‰ë˜ê³  cacheì— ì €ì¥, ë§¤ë²ˆ apië¥¼ ë³´ë‚´ì§€ x 

```js
const {data} = useMe();

tabBarIcon: ({ focused, color, size }) => (
                    data?.me?.avatar ? <Image source={{uri:data.me.avatar}}/> : <TabIcon iconName={"person"} color={color} focused={focused} />)
            }} >
```

- - ë„¤íŠ¸ì›Œí¬ ì´ë¯¸ì§€ëŠ” ë°˜ë“œì‹œ height, widthê°€ í•„ìš”

```js
style={{ height: 20, width: 20, borderRadius: 10, ...(focused && { borderColor: "white", borderWidth: 2 }) }}
```



- searchPhotos
  - ì¿¼ë¦¬ ì‘ì„±
  - useQueryëŠ” componentê°€ mount ë  ë•Œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ê¸°ë•Œë¬¸ì— ì‚¬ìš© x, ì‚¬ìš©ìê°€ ê²€ìƒ‰í• ë•Œë§Œ ì¿¼ë¦¬ ì‹¤í–‰ (lazy query)

```js
const [startQueryFn,{loading, data}] = useLazyQuery(SEARCH_PHOTOS)
// startQueryFn í•¨ìˆ˜ë¥¼ ë¶€ë¥¼ ë•Œ ì¿¼ë¦¬ ì‹¤í–‰
```



### #16.5 Search part 3

- TextInput `onSubmitEditing={startQueryFn}`

- watch : ëª¨ë“  renderì—ì„œ refreshë¨

```js
const [startQueryFn, { loading, data }] = useLazyQuery(SEARCH_PHOTOS, {
    variables: {
        keyword: watch("keyword"),
    }
})
```

- ê²€ìƒ‰ì°½ì„ submit í–ˆì„ ë•Œë§Œ ì¿¼ë¦¬ ì‹¤í–‰
- **called** : í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ 
  -  submití•˜ê¸° ì „ì—ëŠ” Search by keyword ì¶œë ¥

```js
const [startQueryFn, { loading, data, called }] = useLazyQuery(SEARCH_PHOTOS, {
    variables: {
        keyword: watch("keyword"),
    },
});
...

{!called ? (
    <SearchingContainer>
    <SearchingText>Search by keyword</SearchingText>
    </SearchingContainer>
) : null}
```

- ë¬¸ì œ : í•œ ê¸€ìë¥¼ ì…ë ¥í•  ë•Œë§ˆë‹¤ re-renderí•˜ê³  ìˆìŒ(watch ë•Œë¬¸)
- í•´ê²° : onValid function ì‚¬ìš© (data ë„˜ì–´ê°)

```js
const onValid = ({ keyword }) => {
    startQueryFn({
        variables: {
            keyword
        }
    });
}

...
<TextInput
	...
	onSubmitEditing={handleSubmit(onValid)}
/>
                     
...
    useEffect(() => {
        ...
        register("keyword", {
            required: true,
            minLength: 3,
        })
    }, []);
```

- search ê²°ê³¼ê°€ ì—†ì„ ê²½ìš°ë„ ë¶„ê¸°

```js
{data?.searchPhotos !== undefined && 
    data?.searchPhotos?.length === 0 ? (
    <MessageContainer>
    <MessageText>Could not find anything.</MessageText>
    </MessageContainer>
) : null}
```



### #16.6 Search Part 4

- input ìŠ¤íƒ€ì¼ ì„¤ì •
  - input width -> useWindowDimensions ì´ìš©, propsë¡œ ë³´ë‚´ê¸°

```js
{data?.searchPhotos !== undefined ? (
data?.searchPhotos?.length === 0 ? (
    <MessageContainer>
    <MessageText>Could not find anything.</MessageText>
    </MessageContainer>
) : null        // search ê²°ê³¼ display
 ) : null}      // ê²€ìƒ‰í•  ë•Œ
```

1. search ê²°ê³¼ => FlatList
   - FlatListì—ëŠ” ì„¸ê°€ì§€ prop
     - keyExtractorëŠ” ì–¸ì œë‚˜ stringìœ¼ë¡œ ë¦¬í„´í•´ì•¼í•¨

```js
const renderItem = ({ item: photo }) => {
    return (<TouchableOpacity>
        <Image source={{ uri: photo.file }} style={{ width: 50, height: 50 }} />
	</TouchableOpacity>)
}

<FlatList
	numColumns={4}  // 4ê°œ ì—´ë¡œ display
    data={data?.searchPhotos}
    keyExtractor={photo => "" + photo.id}
    renderItem={renderItem}
/>
```



### #16.7 Photo Screen

- search í™”ë©´ì—ì„œ ì‚¬ì§„ì„ í´ë¦­ -> photoë¡œ ì´ë™
  - photoId ì „ë‹¬

```js
// Search.js
const renderItem = ({ item: photo }) => {
    return (
        <TouchableOpacity onPress={() => navigation.navigate("Photo", {
        photoId: photo.id,
    })}>
        <Image source={{ uri: photo.file }} style={{ width: width / numColumns, height: 100 }} />
</TouchableOpacity>)
}
```

- Photo.js
  - photoIdëŠ” routeë¡œ ì „ë‹¬ 

```js
const { data, loading, error } = useQuery(SEE_PHOTO, {
    variables: {
        id: route?.params?.photoId,
    },
});
console.log(data);
```

- render

```js
        <ScreenLayout loading={loading}>
            <ScrollView
                style={{ backgroundColor: "black" }}   // ìŠ¤í¬ë¡¤ ë‚´ë ¸ì„ë•Œ ìŠ¤íƒ€ì¼
                contentContainerStyle={{               // ê¸°ì¡´ ìŠ¤í¬ë¦° ìŠ¤íƒ€ì¼
                    backgroundColor: "black",
                    flex: 1,
                    alignItems: "center",
                    justifyContent: "center"
                }}> 
                <Photo {...data?.seePhoto} />
            </ScrollView>
        </ScreenLayout>
```

- ScrollViewì—ì„œ refreshing í•˜ê¸°
  - flatListì—ì„œ refreshingì´ë‘ ë¹„ìŠ·í•œë° refreshControl ì¨ì¤˜ì•¼í•¨

```js
const [refreshing, setRefreshing] = useState();
const onRefresh = async () => {
    setRefreshing(true);
    await refetch();
    setRefreshing(false);
}
...
    <ScrollView
		refreshControl={
    		<RefreshControl
    			onRefresh={onRefresh}
				refreshing={refreshing}
			/>
}
```

- ìŠ¤í¬ë¡¤ë·°ëŠ”  ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  ì‹¶ê±°ë‚˜ í™”ë©´ì— ë§ì€ ìˆ˜ì˜ componentë‚˜ objectë¥¼ ê°–ê³  ìˆì„ ë•Œ ì‚¬ìš© (í™”ë©´ ë†’ì´ë³´ë‹¤ ë‚´ìš©ì´ ë§ì•„ì„œ ë„˜ì¹˜ëŠ” ê²½ìš°) -??



### #17.0 Modal Navigator

- ì‚¬ì§„ ì—…ë¡œë“œ
- Upload screen ìƒì„±  

- **ì¹´ë©”ë¼ ì•„ì´ì½˜ì„ í´ë¦­í•  ë•Œ ë‹¤ë¥¸ ìŠ¤í¬ë¦°(íƒ­ ì•ˆì— ìˆëŠ” ìŠ¤í¬ë¦°ì´ ì•„ë‹ˆë¼)ìœ¼ë¡œ ë„˜ì–´ê°€ë„ë¡ í•´ì•¼í•¨**

- ìˆ˜ì • ì‚¬í•­ : 

  1) í˜„ì¬ : íƒ­ ë„¤ë¹„ê²Œì´í„° ì†ì— ìŠ¤íƒ ë„¤ë¹„ê²Œì´í„°ê°€ ìˆìŒ(íƒ­ ë„¤ë¹„ê²Œì´í„° ì†ì˜ ê°ê°ì˜ íƒ­ì´ ìŠ¤íƒ)

  => **íƒ­ ë„¤ë¹„ê²Œì´í„° ìŠ¤í¬ë¦°ì„ ìŠ¤íƒ ì•ˆìœ¼ë¡œ ë„£ê¸°** (ìŠ¤íƒ ì•ˆì— íƒ­ ë„¤ë¹„ê²Œì´í„°ê°€ ì¡´ì¬í•˜ë„ë¡ )

  => LoggedInNavë¥¼ StackNavigatorë¡œ ë§Œë“¤ê³  ( BottomTabNavigator ë¥¼ StackNavigatorë¡œ ëŒ€ì²´) ê¸°ì¡´ì— LoggedInNav ì— ìˆë˜ ë‚´ìš©ì„ ë‹¤ë¥¸ Nav íŒŒì¼ë¡œ ëºŒ (TabsNav - TabNavigator) 

  => LoggedInNavì˜ ìŠ¤íƒ ìŠ¤í¬ë¦° ì•ˆì— Tab Navigatorë¥¼ ë¶€ë¦„(TabsNav)

```js
// LoggedInNav.js
<Stack.Navigator screenOptions={{ headerShown : false }}>
            <Stack.Screen name="Tabs" component={TabsNav} />
            <Stack.Screen name="Upload" component={Upload} />
        </Stack.Navigator>
```



- Tabs ìŠ¤í¬ë¦°(ì€ whole ë„¤ë¹„ê²Œì´í„°)ì—ì„œ Upload ìŠ¤í¬ë¦°ìœ¼ë¡œ ë„˜ì–´ê°€ë„ë¡ í•´ì•¼í•¨
  - í•¨ìˆ˜í˜•íƒœ listeners : navigationì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ

```js
// TabsNav.js

<Tabs.Screen
                name="Camera"
                component={View}
                listeners={({ navigation }) => {
                    return {
                        tabPress: (e) => {
                            e.preventDefault();  // ì¹´ë©”ë¼ ì•„ì´ì½˜ ëˆŒë €ì„ë•Œ ê¸°ì¡´ ì´ë²¤íŠ¸ x
                       	    navigation.navigate("Upload");

                        }
                    }
                }
```

- ì¹´ë©”ë¼ ì°½ì„ ëª¨ë‹¬ë¡œ (ë°‘ì—ì„œ ì˜¬ë¼ì˜¤ë„ë¡) í•˜ê¸°

```js
// LoggedInNav.js
<Stack.Navigator screenOptions={{ presentation: "modal", headerShown : false }} >
```



### #17.1 Bottom Tabs Navigator

- ì¹´ë©”ë¼ ì•„ì´ì½˜ í´ë¦­ => ë‹¤ë¥¸ íƒ­ ë„¤ë¹„ê²Œì´í„°

- createMaterialTopTabNavigator 

  - https://reactnavigation.org/docs/material-top-tab-navigator/

  - ì¹´ë©”ë¼ ì•„ì´ì½˜ => ì—…ë¡œë“œ ìŠ¤í¬ë¦°ì„ UploadNavë¡œ ë³€ê²½
  - íƒ­ : Select Photo, Take Photo 

- SelectPhoto tabì•ˆì—ëŠ” ìŠ¤íƒ ë§Œë“¤ê¸°

  - í•¨ìˆ˜ í˜•ì‹ìœ¼ë¡œë„ ë Œë”ë§ ê°€ëŠ¥í•¨

  ```js
  // UploadNav.js
  <Tab.Screen name="Select">
      {() => (
          <Stack.Navigator>
          	<Stack.Screen name="Select" component={SelectPhoto} />
  		</Stack.Navigator>
  		)
  	}
  </Tab.Screen>
  ```

  

