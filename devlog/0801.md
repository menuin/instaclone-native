# ğŸŒ´ DEVLOG 8/1

### #15.8 Photo Part 3

- caption, actions, action íŒŒíŠ¸ 

- Likes.js, Comments.js ì¶”ê°€ (sharedStackNavigator)



### #15.9 Pull to Refresh

- ìœ„ë¡œ ë‹¹ê¸°ë©´ ìƒˆë¡œê³ ì¹¨í•˜ê¸°

1. FlatList ì— refreshing prop ì¶”ê°€ (refreshing={true})
2. onRefresh prop ì¶”ê°€ (í™”ë©´ì„ ë‹¹ê²¼ì„ë•Œ ìƒˆë¡œê³ ì¹¨ë˜ëŠ” function)



- onRefreshí• ë•Œ refetch í•´ì•¼í•¨

```js
const { data, loading, refetch } = useQuery(FEED_QUERY);
// refetch : queryë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” function

const [refreshing, setRefreshing] = useState(false);
  return (
    <ScreenLayout loading={loading}>
      <FlatList
        refreshing={refreshing}
        onRefresh={refetch}
		...
```

-  ì´ë ‡ê²Œ í•´ë„ë¨

```js
const refresh = async() => {
    setRefreshing(true);
    await refetch();
    setRefreshing(false);
}
```





### #15.10 Infinite Scrolling part 1

- infinite scrolling
- ë°±ì—”ë“œ ì½”ë“œ ìˆ˜ì •
  - seeFeed queryë¡œ offset ë³´ëƒ„

```js
// seeFeed.resolvers
seeFeed: protectedResolver((_, { offset }, { loggedInUser }) => client.photo.findMany({
            take: 2,
            skip: offset,
```

```js
// Feed.js
export default function Feed({ navigation }) {
  const [offset, setOffset] = useState(0);
  const { data, loading, refetch } = useQuery(FEED_QUERY,{
    variables:{
      offset, // ì¿¼ë¦¬ë¡œ ë³´ëƒ„
    }
  });
```



1. onEndReached : ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ ë§ˆì§€ë§‰ì— ë„ë‹¬í–ˆë‹¤ê³  react nativeê°€ ì¸ì§€í–ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
   - ê·¼ë° ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ ëì— ë„ë‹¬í•˜ê¸° ì „ì— ë‹¤ìŒ ì‚¬ì§„ì„ preload í•´ì•¼í•¨!

2. onEndReachedThreshold : ìŠ¤í¬ë¡¤ë°”ì˜ ëì§€ì ì´ ì–´ë””ì¸ì§€ ì„¤ì •í•  ìˆ˜ ìˆìŒ

```js
<FlatList
    onEndReachedThreshold={0}
    onEndReached={() => setOffset(2)}
```

- ë” ìì—°ìŠ¤ëŸ½ê²Œ ë¡œë”© (ì§€ê¸ˆì€ ëšëšëŠê¹€)
  - fetchmore : query ë‹¤ì‹œ ë¶ˆëŸ¬ì˜´

```js
onEndReached={()=>fetchMore({
          varaibles : {
              // í˜„ì¬ feedì— ìˆëŠ” ë¦¬ìŠ¤íŠ¸ ê¸¸ì´ë§Œí¼ skip
            offset: data?.seeFeed?.length
          }
        })}
```

- fetchmoreëŠ” ë˜ê³  ìˆëŠ”ë° cacheì— ìˆëŠ” ë°ì´í„°ê°€ ë³€ê²½ë˜ì§€ ì•Šê³  ìˆìŒ



### #15.11 Infinite Scrolling part 2

- fetchMore : ê¸°ì¡´ ë°ì´í„°ëŠ” ë†”ë‘ê³  ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€
- fetchëŠ” ì œëŒ€ë¡œ í–ˆëŠ”ë° apolloê°€ ì¶”ê°€ëœ ë°ì´í„°ë¥¼ cacheì— ë°˜ì˜í•˜ì§€ ì•Šê³  ìˆìŒ
  - componentì˜ state(offset ê°’)ì— ë³€í™” x - ì»´í¬ë„ŒíŠ¸ì˜ stateë¥¼ ë°”ê¿”ì•¼ re renderí•¨!!

- apolloê°€ ë°ì´í„° ì²˜ë¦¬ ë°©ì‹ì„ ëª¨ë¦„ : fetchí•œ queryê°€ ê·¸ ì´ì „ì˜ queryì™€ ê°™ë‹¤ëŠ” ì‚¬ì‹¤ì„ ëª¨ë¦„ (ë‘ ë°ì´í„°ë¥¼ ê²°í•©í•´ì•¼í•¨) 

  ì§€ê¸ˆ queryë“¤ì„ argument(offset)ì— ë”°ë¼ ë…ë¦½ëœ í´ë” ê°™ì€ ê³³ì— ë”°ë¡œ ë”°ë¡œ ì €ì¥ => ì´ë ‡ê²Œ í•˜ì§€ ë§ë¼ê³  ì•Œë ¤ì¤˜ì•¼ í•¨!  



- **typePolicies** : typeì„ ì„¤ì • 
  - seeFeed queryì— í•œí•´ì„œë§Œ argument êµ¬ë³„ ê¸ˆì§€

```js
// apollo.js

const client = new ApolloClient({
    link: authLink.concat(httpLink),
    cache: new InMemoryCache({
        typePolicies : {
            Query : {
                fields : {
                    seeFeed : {
                        keyArgs : false
                    }
                }
            }
        }
    }),
})
```

- ìƒˆë¡œìš´ ë°ì´í„°ì™€ ê¸°ì¡´ ë°ì´í„° í•©ì¹˜ê¸°
  - ì²˜ìŒ ì‹œì‘í• ë•Œ existingì€ empty array

```js
seeFeed: {
    keyArgs: false,
	merge(existing=[], incoming=[]){
        return [...existing, ...incoming];
	},
}
```



- offsetLimitPagination : ìœ„ ì½”ë“œ ì „ë¶€ ëŒ€ì²´

```js
const client = new ApolloClient({
    link: authLink.concat(httpLink),
    cache: new InMemoryCache({
        typePolicies: {
            Query: {
                fields: {
                    seeFeed: offsetLimitPagination()
                }
            }
        }
    }),
})
```



