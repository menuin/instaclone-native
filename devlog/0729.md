# ğŸ¥ DEVLOG 7/29



### #14.9 Login Screen

- input ê¾¸ë¯¸ê¸° (TextInput >> AuthShared.js)
- placeholder ìƒ‰ >> placeholderTextColor prop
- login screenì—ë„ keyboardAvoidingView >> AuthLayoutìœ¼ë¡œ ì˜®ê¸°ê¸°



### #14.10 â­â­ React Hook Forms on Native

- ì›¹ì—ì„œëŠ” inputì— typeì•ˆë¨ >> TouchableWithoutFeedback ë•Œë¬¸

```js
<TouchableWithoutFeedback style={{ flex: 1 }} onPress={dismissKeyboard} disabled={Platform.OS === "web"}>
```

- react hook form : webê³¼ nativeì—ì„œ ëª¨ë‘ ì‚¬ìš©ê°€ëŠ¥

- react nativeì—ëŠ” form ì—†ìŒ!

  - handleSubmit >> AuthButtonì˜ onPress / password ì…ë ¥í•˜ê³  done í–ˆì„ë•Œ

  ```js
  <TextInput
      ...
      onSubmitEditing = {handleSubmit(onValid)}
  />
  <AuthButton
      text="Log In"
      disabled={false}
      onPress={handleSubmit(onValid)}
  />
  ```

  

- registerëŠ” inputì— ì¨ì£¼ì§€ ì•Šê³  useEffectì— ì”€
  - ì´ì „ì—ëŠ” textInputì— ì¨ë†“ì€ nameì„ registerì— ê·¸ëŒ€ë¡œ ì¨ì•¼í–ˆëŠ”ë° ì—¬ê¸°ì„œëŠ” placeholderì™€ ë‹¤ë¥¸ nameì„ ì¨ì¤˜ë„ ë¨ (setValueì˜ name ê³¼ ë§ì¶°ì„œ )

```js
useEffect(() => {
        register("username");
        register("password");
    }, [register]) //registerê°€ ë³€ê²½ë ë•Œ ì‹¤í–‰
```



- onChangeText >> react nativeì—ë§Œ ìˆìŒ, onChangeë‘ ë¹„ìŠ·, textê°€ ë°”ë€Œì—ˆì„ë•Œ ì‹¤í–‰ (ë°©ê¸ˆ ë°”ë€ textë¥¼ argumentë¡œ ë„˜ê¹€)

```js
<TextInput
    ...
    onChangeText = {(text) =>setValue("username", text)}
/>
```



- createAccountë„ ë˜‘ê°™ì´ í•˜ê¸°



### #14.11 Apollo client

- register ìœ íš¨ì„± ê²€ì‚¬ : required: true
- AuthButton : loading ì¤‘ì¼ë•Œ/ëë‚¬ì„ë•Œ
  - ActivityIndicator : ë¡œë”© ì• ë‹ˆë©”ì´ì…˜

```js
export default function AuthButton({ onPress, disabled, text, loading }) {
    return (
        <Button disabled={disabled} onPress={onPress}>
            {loading ? <ActivityIndicator color="white" /> : <ButtonText>{text}</ButtonText>}
        </Button>
    )
}
```

- apollo client
  -  npm install @apollo/client graphql
  - uri : ë°±ì—”ë“œê°€ ëŒì•„ê°€ëŠ” ê³³ 

```js
// apollo.js
const client = new ApolloClient({
    uri: "http://localhost:4000/graphql",
    cache: new InMemoryCache(),
})
```

- App.js ì— ApolloProvier ì¶”ê°€

- ê·¼ë° uriëŠ” ì»´í“¨í„° ìƒì—ì„œì™€ í•¸ë“œí° ìƒì—ì„œ ë‹¤ë¦„!(í•¸ë“œí°ì—ëŠ” localhostì—†ìŒ)
  1. ip ì£¼ì†Œ ì—°ê²°
  2. ngrok 
     - ngrok http 4000(ë°”ê¹¥ì— ë…¸ì¶œì‹œí‚¤ê³  ì‹¶ì€ í¬íŠ¸ë²ˆí˜¸)
     - ì£¼ì†Œ(localhost:4000ê³¼ ê°™ìŒ) ë³µì‚¬í•´ì„œ uriì— ë„£ê¸° 
     - /graphql ë¶™ì—¬ì¤˜ì•¼ í•¨
  3. localtunnel
     - npx localtunnel --port 4000



### #14.12 Log In Mutation

- ìƒˆë¡œìš´ ë„¤ë¹„ê²Œì´í„° : LoggedInNav >> íƒ­ ë„¤ë¹„ê²Œì´í„°
  - npm install @react-navigation/bottom-tabs
  - createStackNavigatorë‘ ë°©ì‹ ë™ì¼

```js
// LoggedInNavs.js
const Tabs = createBottomTabNavigator();

export default function LoggedInNav(){
    return (
        <Tabs.Navigator>
            <Tabs.Screen name="Feed" component={Feed} />
        </Tabs.Navigator>
    )
}
```

- ë¡œê·¸ì¸ì„ í–ˆì„ë• LoggedInNavë¥¼ ë³´ì´ê²Œ í•˜ê³  ë¡œê·¸ì•„ì›ƒí–ˆì„ë• LoggedOutNav ë³´ì´ê²Œí•´ì•¼í•¨ >> reactive variable ì‚¬ìš©

```JS
// apollo.js
export const isLoggedInVar = makeVar(false);

// App.js
if (loading) { // ì²«ë²ˆì§¸ render
    return (
      <AppLoading
        startAsync={preload}
        onError={console.warn}
        onFinish={onFinish}
      />)
  }
  const isLoggedIn = useReactiveVar(isLoggedInVar)
  return (  // ë‘ë²ˆì§¸ render
    <ApolloProvider client={client}>
      <AppearanceProvider>
        <NavigationContainer>
          {isLoggedIn ? <LoggedInNav /> : <LoggedOutNav />}
        </NavigationContainer>
      </AppearanceProvider>
    </ApolloProvider>
  );
```

ì—ëŸ¬ : Rendered more hooks than during the previous render

- ì²«ë²ˆì§¸ renderì—ì„œ useReactiveVar Hookì€ í¬í•¨ë˜ì§€ì•Šì•˜ìŒ

  => â­â­ëª¨ë“  hookì€ í•­ìƒ ë Œë”ë§ë˜ì–´ì•¼ í•¨



- login mutation

```js
const LOG_IN_MUTATION = gql`
    mutation login($username:String!, $password:String!){
        login(username:$username, password:$password){
            ok
            token
            error
        }
    }
`
export default function Login() {
    const [loginMutation, { loading }] = useMutation(LOG_IN_MUTATION);
    const onValid = (data) => {
        if (!loading) {
            loginMutation({
                variables: {
                    ...data,
                    // form itemì˜ ì´ë¦„ì´ formì— ìˆëŠ” ì´ë¦„ê³¼ ê°™ë‹¤ë©´ ì´ë ‡ê²Œ ì¨ë„ ë¨
                }
            })
        }
    };
}
```

- í¼ì´ validí•˜ì§€ ì•Šìœ¼ë©´ ë²„íŠ¼ disabled í•˜ê¸°
  - formStateëŠ” ë„¤ì´í‹°ë¸Œì—ì„œ ì‚¬ìš©í• ìˆ˜x
  - watch : formì˜ ê°’ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì§€ì¼œë´„ (getValuesëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ì§€ì¼œë³´ì§€x)

```js
const { register, handleSubmit, setValue, watch } = useForm()

disabled={!watch("username" || !watch("password"))}
```



ğŸ’¦ ğŸ’¦ğŸ’¦ uri : http://localhost:4000/graphqlë¡œ í•˜ê³  localtunnel ì—´ì–´ë„ í•¸ë“œí°ì—ì„œ ë°±ì—”ë“œ ì—°ê²° ëª»í•¨

localtunnelë¡œ ì—° url https://silent-cat-11.loca.lt ì„ uriì— ë„£ìœ¼ë©´ í•¸ë“œí°ì—ì„  ë˜ëŠ”ë° ì›¹ì—ì„  ë°±ì—”ë“œ ì—°ê²° ëª»í•¨



### #14.13 CreateAccount Mutation

- create account >> login í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ëŠ”ë° usernameì´ë‘ passwordë¥¼ ë“¤ê³  (ë¡œê·¸ì¸ í™”ë©´ì— ë„ì›€)

```js
// CreateAccount.js
const onCompleted = (data) => {
    const { createAccount: { ok } } = data;
    const { username, password } = getValues();
    if (ok) {
        // parameterë¥¼ ë“¤ê³  navigate
        navigation.navigate("Login", {
            username,
            password
        })
    }
}
```

- route parameter

```js
// Login.js
export default function Login({ route: { params } }) {
    const { register, handleSubmit, setValue, watch } = useForm({
        defaultValues: {
            password: params?.password,
            username: params?.username,
        }
    })
...
        
return (
        <AuthLayout>
            <Text>Login</Text>
            <TextInput
                value={watch("username")}
                ...
            />
            <TextInput
                value={watch("password")}
                ...
            />
```

- íšŒì›ê°€ì… >> ë¡œê·¸ì¸ >> ìƒˆë¡œê³ ì¹¨í•˜ë©´ welcomeí™”ë©´ìœ¼ë¡œ ëŒì•„ê°(ë¡œê·¸ì¸ ê¸°ì–µëª»í•¨)



### #14.14 AsyncStorage part 1

- ì•±ì´ ìš°ë¦¬ê°€ ë¡œê·¸ì¸ í–ˆëŠ”ì§€ ì•ˆí–ˆëŠ”ì§€ë¥¼ ê¸°ì–µëª»í•˜ê³  ìˆìŒ

- ì›¹ -> ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë°›ì•„ì™€ì„œ ì´ˆê¸° ì„¤ì •
- ì•± -> ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì—†ìŒ. í•¨ìˆ˜ ë§Œë“¤ê¸°

- AsyncStorageì— ê°’ì„ ì €ì¥í•˜ê¸° : ë„¤ì´í‹°ë¸Œë¥¼ ìœ„í•œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê°™ì€ê±° (ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œì—ì„œ ë”ì´ìƒ ì§€ì› x -> ë¦¬ì•¡íŠ¸ ë„¤ì´í‹°ë¸Œ íŒ¨í‚¤ì§€ë¡œ ì„¤ì¹˜https://reactnative.directory/)  ë‹¨ await ì‚¬ìš©

- JSON.stringify í•„ìˆ˜

```js
// apollo.js
export const logUserIn = async (token) => {
    await AsyncStorage.multiSet([
        ["token", JSON.stringify(token)],
        ["loggedIn", JSON.stringify('yes')],
    ])
    isLoggedInVar(true)
}
```

- login mutationì˜ onCompletedì— ì—°ê²°
- "expo install" calls "npm install"



### #14.15 AsyncStorage part 2

- AsyncStorageì—ì„œ ê°’ì„ ë¶ˆëŸ¬ì˜¤ê¸°

- AppLoading (#13.6) : ì•±ì´ ì‹œì‘ë˜ê¸°ì „ì— ì›í•˜ëŠ” ê°’ì„ ë¶ˆëŸ¬ë†“ìŒ.

- ì›¹ì—ì„œëŠ” í† í°ì„ í—¤ë”ì— ë„£ì–´ì„œ requestí• ë•Œë§ˆë‹¤ ë¶ˆëŸ¬ì˜´

  requetí• ë•Œë§ˆë‹¤ asyncStorageë¥¼ ì‚¬ìš© x >>  reactive variableì— ì €ì¥ > r.vì—ì„œ í† í°ì„ êº¼ë‚´ì„œ í—¤ë”ì— ë„£ê¸°

```js
const preloadAssets = () => {
    // preload -> preloadAssetsë¡œ ì˜®ê¸°ê¸° (preloadì— async ì‚¬ìš©ìœ„í•¨)
    const fontsToLoad = [Ionicons.font]
    const fontPromises = fontsToLoad.map((font) => Font.loadAsync(font));
    const imagesToLoad = [
        require("./assets/logo.png"),
    ]
    const ImagePromises = imagesToLoad.map(image => Asset.loadAsync(image))

    return Promise.all([...fontPromises, ...ImagePromises]);
}

const preload = async () => {
    const token = await AsyncStorage.getItem("token");
    if (token) {
        isLoggedInVar(true);
        // reactive variableì— í† í° ì €ì¥
        tokenVar(token);
    }
    return preloadAssets();
}
```

```js
// apollo.js
export const tokenVar = makeVar("");

export const logUserIn = async (token) => {
  await AsyncStorage.multiSet([
    ["token", JSON.stringify(token)],
    ["loggedIn", JSON.stringify("yes")],
  ]);
  isLoggedInVar(true);
  tokenVar(token);
};
```

